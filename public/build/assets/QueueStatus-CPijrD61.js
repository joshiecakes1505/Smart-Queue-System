import{u as q}from"./usePolling-fYbqRw8i.js";import{f as o,a as e,t as r,k as m,F as c,s as N,h as C,g as F,d as g,y as u,o as n}from"./app-A4PEbC9S.js";const Q={class:"min-h-screen bg-[#f7f5f3] py-4 px-3 sm:px-4"},L={class:"max-w-md mx-auto space-y-4"},D={key:0,class:"bg-white rounded-xl shadow-sm border border-gray-100 p-6 text-center text-gray-500"},E={key:1,class:"bg-white rounded-xl shadow-sm border border-red-200 p-6 text-center"},T={class:"text-lg font-semibold text-red-700"},$={class:"text-sm text-gray-600 mt-2"},A={class:"font-semibold text-[#800000]"},B={class:"bg-white rounded-xl shadow-sm border border-gray-100 p-4"},W={key:0,class:"bg-[#800000] text-white rounded-lg p-4 text-center"},j={class:"text-xs mb-1"},P={class:"text-4xl font-bold leading-none"},U={class:"text-xs mt-2 text-[#ffe8a3]"},V={key:1,class:"bg-gray-50 rounded-lg p-4 text-center text-gray-500 text-sm"},G={class:"bg-white rounded-xl shadow-sm border border-gray-100 p-4"},z={class:"mt-2 bg-[#fff4cc] border border-[#FFC107] rounded-lg p-4 text-center"},I={class:"text-5xl font-bold text-[#800000] leading-none"},Y={class:"mt-4 grid grid-cols-2 gap-3 text-sm"},H={class:"bg-gray-50 rounded-lg px-3 py-2"},J={class:"font-semibold text-[#800000]"},K={class:"text-xs"},M={class:"bg-gray-50 rounded-lg px-3 py-2"},O={class:"font-semibold text-[#800000]"},R={class:"bg-gray-50 rounded-lg px-3 py-2 col-span-2"},X={class:"font-semibold text-[#800000]"},Z={class:"bg-gray-50 rounded-lg px-3 py-2 col-span-2"},ee={class:"font-semibold text-[#800000]"},te={key:0,class:"text-xs text-gray-500 mt-1"},se={class:"bg-gray-50 rounded-lg px-3 py-2 col-span-2"},ae={class:"font-semibold text-gray-800"},re={class:"bg-white rounded-xl shadow-sm border border-gray-100 p-4"},oe={class:"space-y-2"},ne={class:"text-sm font-semibold text-[#800000]"},le={class:"text-xs text-gray-500"},ue={class:"text-sm font-semibold text-gray-800"},ge={__name:"QueueStatus",props:{queue_number:String},setup(x){const b=x,t=g(null),p=g({windows:[]}),v=g(!0),l=g(null),_=u(()=>(p.value?.windows||[]).filter(s=>s.current).map(s=>({windowName:s.name,queueNumber:s.current.queue_number,serviceCategory:s.current.service_category}))),i=u(()=>_.value[0]||null),y=u(()=>{if(!t.value?.position)return"";const s=t.value.position;if(s%100>=11&&s%100<=13)return"th";switch(s%10){case 1:return"st";case 2:return"nd";case 3:return"rd";default:return"th"}}),f=u(()=>{if(!t.value)return"Loading...";switch(t.value.status){case"called":return`Now called at ${t.value.cashier_window||"Cashier Window"}`;case"completed":return"Service completed";case"skipped":return"Skipped (please see frontdesk)";case"waiting":return`Waiting • #${t.value.position||"-"} in line`;default:return`Status: ${t.value.status}`}}),h=u(()=>{if(!t.value)return"bg-gray-100 text-gray-700 border-gray-200";switch(t.value.status){case"called":return"bg-[#fff4cc] text-[#800000] border-[#FFC107]";case"completed":return"bg-green-50 text-green-700 border-green-200";case"skipped":return"bg-gray-100 text-gray-700 border-gray-200";default:return"bg-[#fdf2f2] text-[#800000] border-[#f7cccc]"}}),w=u(()=>{const s=t.value?.estimated_served_at;return s?new Date(s).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"}):"—"}),k=async()=>{try{const s=await fetch(`/api/queue/${b.queue_number}/status`);if(!s.ok){l.value="Queue not found",t.value=null;return}t.value=await s.json(),l.value=null}catch(s){console.error("Failed to fetch queue data:",s),l.value="Unable to load queue status"}},S=async()=>{try{const s=await fetch("/public/live");if(!s.ok)return;p.value=await s.json()}catch(s){console.error("Failed to fetch live data:",s)}};return q(async()=>{v.value=!0,await Promise.all([k(),S()]),v.value=!1},5e3),(s,a)=>(n(),o("div",Q,[e("div",L,[a[9]||(a[9]=e("div",{class:"bg-white rounded-xl shadow-sm border border-gray-100 p-4 text-center"},[e("p",{class:"text-xs uppercase tracking-wide text-gray-500"},"Batangas Eastern Colleges"),e("h1",{class:"text-lg font-semibold text-[#800000]"},"Queue Status Tracker"),e("p",{class:"text-xs text-gray-500 mt-1"},"Live updates every 5 seconds")],-1)),v.value&&!t.value&&!l.value?(n(),o("div",D," Loading queue details... ")):l.value?(n(),o("div",E,[e("h2",T,r(l.value),1),e("p",$,[a[0]||(a[0]=m("Queue Number: ",-1)),e("span",A,r(x.queue_number),1)])])):(n(),o(c,{key:2},[e("div",B,[a[1]||(a[1]=e("p",{class:"text-xs uppercase tracking-wide text-gray-500 mb-2"},"Now Serving",-1)),i.value?(n(),o("div",W,[e("p",j,r(i.value.windowName),1),e("p",P,r(i.value.queueNumber),1),e("p",U,r(i.value.serviceCategory||"General Service"),1)])):(n(),o("div",V," No active queue being served right now. "))]),e("div",G,[a[7]||(a[7]=e("p",{class:"text-xs uppercase tracking-wide text-gray-500"},"Your Queue Number",-1)),e("div",z,[e("p",I,r(t.value?.queue_number||x.queue_number),1)]),e("div",{class:N(["mt-3 border rounded-lg px-3 py-2 text-sm",h.value])},r(f.value),3),e("div",Y,[e("div",H,[a[2]||(a[2]=e("p",{class:"text-gray-500 text-xs"},"Position",-1)),e("p",J,[t.value?.position?(n(),o(c,{key:0},[m(r(t.value.position),1),e("span",K,r(y.value),1)],64)):(n(),o(c,{key:1},[m(" — ")],64))])]),e("div",M,[a[3]||(a[3]=e("p",{class:"text-gray-500 text-xs"},"Estimated Wait",-1)),e("p",O,r(t.value?.eta_minutes===0?"Next":t.value?.eta_minutes!==null?`~${t.value?.eta_minutes} min`:"—"),1)]),e("div",R,[a[4]||(a[4]=e("p",{class:"text-gray-500 text-xs"},"Estimated Serving Time",-1)),e("p",X,r(w.value),1)]),e("div",Z,[a[5]||(a[5]=e("p",{class:"text-gray-500 text-xs"},"Queues Ahead",-1)),e("p",ee,r(t.value?.queues_ahead??"—"),1),t.value?.queues_ahead!==null?(n(),o("p",te,r(t.value?.waiting_ahead??0)+" waiting + "+r(t.value?.active_called_ahead??0)+" currently serving ",1)):C("",!0)]),e("div",se,[a[6]||(a[6]=e("p",{class:"text-gray-500 text-xs"},"Service Category",-1)),e("p",ae,r(t.value?.service_category||"General Service"),1)])])]),e("div",re,[a[8]||(a[8]=e("p",{class:"text-xs uppercase tracking-wide text-gray-500 mb-3"},"All Windows",-1)),e("div",oe,[(n(!0),o(c,null,F(p.value.windows,d=>(n(),o("div",{key:d.id,class:"rounded-lg border border-gray-100 bg-gray-50 px-3 py-2 flex items-center justify-between"},[e("div",null,[e("p",ne,r(d.name),1),e("p",le,r(d.assigned_user||"Unassigned"),1)]),e("p",ue,r(d.current?.queue_number||"Idle"),1)]))),128))])])],64))])]))}};export{ge as default};
