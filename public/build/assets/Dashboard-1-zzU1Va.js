import{_ as A}from"./AuthenticatedLayout-DHRYX0-q.js";import{i as F,c as S,w as E,o as l,f as d,a as e,t as c,s as m,h as b,F as h,g as f,d as p,r as y}from"./app-A4PEbC9S.js";import{u as B}from"./usePolling-fYbqRw8i.js";const L={key:0,class:"bg-yellow-50 border border-yellow-200 rounded-lg p-6 text-center"},T={key:1,class:"space-y-6"},R={class:"bg-white rounded-lg shadow-sm p-6"},D={class:"text-4xl font-bold text-[#800000]"},P={class:"bg-white rounded-lg shadow-sm p-6"},j={key:0,class:"space-y-4"},U={class:"bg-[#800000] text-white rounded-lg p-8 text-center"},Y={class:"text-6xl font-bold"},$={class:"text-center text-gray-600"},z={class:"text-sm"},O={class:"text-sm"},V={key:1,class:"bg-gray-50 rounded-lg p-8 text-center"},W={class:"bg-white rounded-lg shadow-sm p-6"},G={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3"},H=["disabled"],I=["disabled"],J=["disabled"],K=["disabled"],M={class:"bg-white rounded-lg shadow-sm p-6"},X={class:"overflow-x-auto"},Z={class:"w-full"},ee={key:0},te={class:"py-3 px-4 font-semibold text-[#800000]"},re={class:"py-3 px-4"},se={class:"py-3 px-4"},oe=["onClick","disabled"],ie={class:"bg-white rounded-lg shadow-sm p-6"},ne={key:0,class:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-5 gap-3"},le={class:"text-lg font-bold text-[#800000]"},ae={class:"text-xs text-gray-600 mt-1"},de={key:1,class:"text-center py-6 text-gray-500"},ce={class:"bg-white rounded-lg shadow-sm p-6"},ue={class:"overflow-x-auto"},ge={class:"w-full"},xe={key:0},be={class:"py-3 px-4 font-semibold text-[#800000]"},he={class:"py-3 px-4"},fe={class:"py-3 px-4"},me={class:"py-3 px-4 text-gray-600"},ke={__name:"Dashboard",props:{window:Object,current:Object,next:Array,recentLogs:Array,skippedEligible:{type:Array,default:()=>[]}},setup(n){const u=n,a=p(!1),x=p({type:"",message:""}),s=F("$swal"),i=(r,t)=>{x.value={type:r,message:t}},w=r=>r==="success"?"bg-green-50 border-green-200 text-green-800":r==="warning"?"bg-yellow-50 border-yellow-200 text-yellow-800":r==="error"?"bg-red-50 border-red-200 text-red-800":"bg-gray-50 border-gray-200 text-gray-800",g=()=>{y.reload({only:["current","next","recentLogs","skippedEligible"]})},v=()=>{if(!u.window){i("error","No cashier window assigned. Please contact an administrator."),s?.fire({icon:"error",title:"No assigned window",text:"Please contact an administrator."});return}if(u.current){i("warning","Finish the current queue before calling the next one."),s?.fire({icon:"warning",title:"Queue in progress",text:"Finish the current queue before calling the next one."});return}a.value=!0,window.axios.post(route("cashier.callNext"),{window_id:u.window.id}).then(r=>{if(r.data?.status==="ok"){i("success","Next queue has been called."),s?.fire({icon:"success",title:"Called",text:"Next queue has been called."}),g();return}if(r.data?.status==="empty"){i("warning","No waiting queues available."),s?.fire({icon:"info",title:"No queue",text:"No waiting queues available."});return}i("error","Unable to call next queue."),s?.fire({icon:"error",title:"Failed",text:"Unable to call next queue."})}).catch(()=>{i("error","An error occurred while calling the next queue."),s?.fire({icon:"error",title:"Error",text:"An error occurred while calling the next queue."})}).finally(()=>{a.value=!1})},k=async()=>{if(!u.current)return;const r=await s?.fire({icon:"warning",title:"Skip queue?",text:"This will mark the current queue as skipped.",showCancelButton:!0,confirmButtonText:"Yes, skip"});s&&!r?.isConfirmed||(a.value=!0,window.axios.post(route("cashier.skip",u.current.id)).then(t=>{if(t.data?.status==="ok"){i("success","Queue has been skipped."),s?.fire({icon:"success",title:"Skipped",text:"Queue has been skipped."}),g();return}i("error","Queue was not found."),s?.fire({icon:"error",title:"Not found",text:"Queue was not found."})}).catch(()=>{i("error","An error occurred while skipping the queue."),s?.fire({icon:"error",title:"Error",text:"An error occurred while skipping the queue."})}).finally(()=>{a.value=!1}))},_=()=>{u.current&&(a.value=!0,window.axios.post(route("cashier.recall",u.current.id)).then(r=>{if(r.data?.status==="ok"){i("success","Queue has been recalled."),s?.fire({icon:"success",title:"Recalled",text:"Queue has been recalled."}),g();return}i("error","Queue was not found."),s?.fire({icon:"error",title:"Not found",text:"Queue was not found."})}).catch(()=>{i("error","An error occurred while recalling the queue."),s?.fire({icon:"error",title:"Error",text:"An error occurred while recalling the queue."})}).finally(()=>{a.value=!1}))},N=async()=>{if(!u.current)return;const r=await s?.fire({icon:"question",title:"Complete queue?",text:"This will mark the current queue as completed.",showCancelButton:!0,confirmButtonText:"Yes, complete"});s&&!r?.isConfirmed||(a.value=!0,window.axios.post(route("cashier.complete",u.current.id)).then(t=>{if(t.data?.status==="ok"){i("success","Queue has been marked as completed."),s?.fire({icon:"success",title:"Completed",text:"Queue has been marked as completed."}),g();return}i("error","Queue was not found."),s?.fire({icon:"error",title:"Not found",text:"Queue was not found."})}).catch(()=>{i("error","An error occurred while completing the queue."),s?.fire({icon:"error",title:"Error",text:"An error occurred while completing the queue."})}).finally(()=>{a.value=!1}))},C=r=>{if(r){if(r.skip_count>=2||r.is_reinstated){i("warning","Queue is no longer eligible for reinstatement."),s?.fire({icon:"warning",title:"Not eligible",text:"Queue is no longer eligible for reinstatement."});return}a.value=!0,window.axios.post(route("cashier.reinstate",r.id)).then(t=>{if(t.data?.status==="ok"){i("success","Queue has been reinstated and returned to waiting."),s?.fire({icon:"success",title:"Reinstated",text:"Queue has been reinstated and returned to waiting."}),g();return}i("error",t.data?.message||"Queue is not eligible for reinstatement."),s?.fire({icon:"error",title:"Failed",text:t.data?.message||"Queue is not eligible for reinstatement."})}).catch(t=>{const o=t?.response?.data?.message||"An error occurred while reinstating the queue.";i("error",o),s?.fire({icon:"error",title:"Error",text:o})}).finally(()=>{a.value=!1})}},Q=r=>{switch(r){case"completed":return"bg-green-100 text-green-800";case"skipped":return"bg-gray-100 text-gray-800";case"called":return"bg-blue-100 text-blue-800";default:return"bg-yellow-100 text-yellow-800"}},q=r=>new Date(r).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"});return B(()=>y.reload({only:["window","current","next","recentLogs","skippedEligible"],preserveState:!0,preserveScroll:!0}),2e3),(r,t)=>(l(),S(A,{title:"Cashier Dashboard"},{default:E(()=>[n.window?(l(),d("div",T,[e("div",R,[t[1]||(t[1]=e("h2",{class:"text-xl font-semibold text-[#800000] mb-2"},"Assigned Window",-1)),e("p",D,c(n.window.name),1)]),e("div",P,[t[4]||(t[4]=e("h2",{class:"text-xl font-semibold text-[#800000] mb-4"},"Now Serving",-1)),n.current?(l(),d("div",j,[e("div",U,[t[2]||(t[2]=e("p",{class:"text-sm mb-2"},"Queue Number",-1)),e("p",Y,c(n.current.queue_number),1)]),e("div",$,[e("p",z,"Service: "+c(n.current.service_category?.name||"N/A"),1),e("p",O,"Client: "+c(n.current.client_name||"Walk-in"),1)])])):(l(),d("div",V,[...t[3]||(t[3]=[e("p",{class:"text-gray-500 text-lg"},"No active queue",-1),e("p",{class:"text-gray-400 text-sm mt-2"},'Click "Call Next" to serve the next queue',-1)])]))]),e("div",W,[t[5]||(t[5]=e("h2",{class:"text-xl font-semibold text-[#800000] mb-4"},"Queue Controls",-1)),x.value.message?(l(),d("div",{key:0,class:m([w(x.value.type),"mb-4 border rounded-lg px-4 py-3 text-sm"])},c(x.value.message),3)):b("",!0),e("div",G,[e("button",{onClick:v,disabled:a.value||!!n.current,class:"bg-[#FFC107] hover:bg-[#FFB300] text-[#800000] px-6 py-4 rounded-lg font-semibold transition disabled:opacity-50 text-lg"}," Call Next ",8,H),e("button",{onClick:k,disabled:a.value||!n.current,class:"border-2 border-gray-500 hover:bg-gray-500 hover:text-white text-gray-600 px-6 py-4 rounded-lg font-semibold transition disabled:opacity-50"}," Skip ",8,I),e("button",{onClick:_,disabled:a.value||!n.current,class:"border-2 border-[#800000] hover:bg-[#800000] hover:text-white text-[#800000] px-6 py-4 rounded-lg font-semibold transition disabled:opacity-50"}," Recall ",8,J),e("button",{onClick:N,disabled:a.value||!n.current,class:"border-2 border-[#800000] hover:bg-[#800000] hover:text-white text-[#800000] px-6 py-4 rounded-lg font-semibold transition disabled:opacity-50"}," Complete ",8,K)])]),e("div",M,[t[8]||(t[8]=e("h2",{class:"text-xl font-semibold text-[#800000] mb-4"},"Skipped Queues (Eligible for Reinstatement)",-1)),e("div",X,[e("table",Z,[t[7]||(t[7]=e("thead",null,[e("tr",{class:"border-b border-gray-200"},[e("th",{class:"text-left py-3 px-4 font-semibold text-gray-700"},"Queue Number"),e("th",{class:"text-left py-3 px-4 font-semibold text-gray-700"},"Service Category"),e("th",{class:"text-left py-3 px-4 font-semibold text-gray-700"},"Action")])],-1)),e("tbody",null,[n.skippedEligible.length===0?(l(),d("tr",ee,[...t[6]||(t[6]=[e("td",{colspan:"3",class:"text-center py-8 text-gray-500"}," No eligible skipped queues ",-1)])])):b("",!0),(l(!0),d(h,null,f(n.skippedEligible,o=>(l(),d("tr",{key:o.id,class:"border-b border-gray-100 hover:bg-gray-50"},[e("td",te,c(o.queue_number),1),e("td",re,c(o.service_category?.name||"N/A"),1),e("td",se,[e("button",{onClick:pe=>C(o),disabled:a.value||o.skip_count>=2||o.is_reinstated,class:"border-2 border-[#FFC107] hover:bg-[#FFC107] text-[#800000] px-4 py-2 rounded-lg font-semibold transition disabled:opacity-50"}," Reinstate ",8,oe)])]))),128))])])])]),e("div",ie,[t[9]||(t[9]=e("h2",{class:"text-xl font-semibold text-[#800000] mb-4"},"Next in Queue",-1)),n.next.length>0?(l(),d("div",ne,[(l(!0),d(h,null,f(n.next,o=>(l(),d("div",{key:o.id,class:"bg-gray-50 rounded-lg p-4 text-center"},[e("p",le,c(o.queue_number),1),e("p",ae,c(o.service_category?.name||"N/A"),1)]))),128))])):(l(),d("div",de," No queues waiting "))]),e("div",ce,[t[12]||(t[12]=e("h2",{class:"text-xl font-semibold text-[#800000] mb-4"},"Recent Activity",-1)),e("div",ue,[e("table",ge,[t[11]||(t[11]=e("thead",null,[e("tr",{class:"border-b border-gray-200"},[e("th",{class:"text-left py-3 px-4 font-semibold text-gray-700"},"Queue Number"),e("th",{class:"text-left py-3 px-4 font-semibold text-gray-700"},"Service"),e("th",{class:"text-left py-3 px-4 font-semibold text-gray-700"},"Status"),e("th",{class:"text-left py-3 px-4 font-semibold text-gray-700"},"Time")])],-1)),e("tbody",null,[n.recentLogs.length===0?(l(),d("tr",xe,[...t[10]||(t[10]=[e("td",{colspan:"4",class:"text-center py-8 text-gray-500"}," No recent activity ",-1)])])):b("",!0),(l(!0),d(h,null,f(n.recentLogs,o=>(l(),d("tr",{key:o.id,class:"border-b border-gray-100 hover:bg-gray-50"},[e("td",be,c(o.queue_number),1),e("td",he,c(o.service_category?.name||"N/A"),1),e("td",fe,[e("span",{class:m([Q(o.status),"px-3 py-1 rounded-full text-sm capitalize"])},c(o.status),3)]),e("td",me,c(q(o.updated_at)),1)]))),128))])])])])])):(l(),d("div",L,[...t[0]||(t[0]=[e("p",{class:"text-yellow-800 font-semibold"},"You are not assigned to any cashier window.",-1),e("p",{class:"text-yellow-700 text-sm mt-2"},"Please contact an administrator.",-1)])]))]),_:1}))}};export{ke as default};
